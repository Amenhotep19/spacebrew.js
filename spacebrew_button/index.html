<!DOCTYPE HTML>
<html>
	<head>
		<title>Spacebrew button</title>
		<meta charset="utf-8">
		<link rel="stylesheet" href="css/reset.css" type="text/css" media="screen" charset="utf-8" />
		<link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />
		<!-- basic libraries -->
    <script type="text/javascript" src="js/jquery/jq.js"></script>
    <!-- Spacebrew libraries -->
    <script type="text/javascript" src="js/jquery/jq.js"></script>
    <script type="text/javascript">

    /**
     * [sb description]
     * @type {Spacebrew.Client}
     */
      var sb;

      var index = 0;
      var buttonPress = false;
      var buttonText = "";

      function onRangeMessage( name, value ){
        if (name == "color") {
          console.log("received color message");
          changeBGC(value);
        }
        incrementIndex();
      }

      function onStringMessage( name, value ){
        // if itâ€™s a text
        if (name == "text") {
          console.log("received text message"); 
          buttonText = value; 
          document.getElementById("buttonMsg").innerHTML = value;        
        } 
        incrementIndex();
      }

      $(document).ready( function() {
        sb = new Spacebrew.Client();
        sb.description = "This is an example client which has a big red button you can push to send a message. It also listens for color events and will change it's color based on those messages.";

        sb.addPublish( "buttonPress", "boolean", "false" );
        sb.addSubscribe( "color", "range" );
        sb.addSubscribe( "text", "string" );

        sb.onRangeMessage = onRangeMessage;
        sb.onStringMessage = onStringMessage;

        sb.connect();
      	setup();
      });

      //-------------------------------------------------------
      function setup (){
      // 	// listen to the mouse
      	window.addEventListener("mousedown", onMouseDown);
      }

      function incrementIndex() {
          index += 1;
          //console.log(index);
      }

      function changeBGC(pColor){
        var tColor = "rgb("+Math.floor(pColor/4)+","+Math.floor(pColor/4)+","+Math.floor(pColor/4)+")";
        document.body.style.background = tColor; //color;
        console.log(tColor);
        console.log("Changed color");
      }

      //-------------------------------------------------------
      function onMouseDown (evt){
      	//ecs.sendMessage("packet", 255);
      	console.log("Sending message"); 
         	//console.log(message);
         	sb.send("buttonPress", "boolean", "true");
      }

</script>
		<!-- MAIN -->
	</head>
	<body>
		<h1>Click to send a message to spacebrew</h1>
		<h3 id="numclicks"></h3>
    <a class="button" id="buttonMsg">Click Me</a>
   </body>
</html>